var JSONstatUtils=function(){"use strict";function e(e){function t(t){"undefined"!=typeof e.selector?e.selector.innerHTML=c[t]:window.alert(c[t])}function n(e,t,n){var r={filter:{}};return n.forEach(function(e){"rows"===e.name||"cols"===e.name?r[e.name]=e.value:r.filter[e.name]=e.value}),"rowscols"===t&&(r.filter={},e.id.forEach(function(t,n){t!==r.rows&&t!==r.cols&&(r.filter[t]=e.Dimension(n).id[0])})),r}function r(e){var t=e.id,n=t[0],r=t[1],o={};e.Dimension(0).length<e.Dimension(1).length&&(n=t[1],r=t[0]);for(var i=2,l=t.length;l>i;i++)o[t[i]]=e.Dimension(i).id[0];return{rows:n,cols:r,filter:o}}function o(e){var t=[],n=[].slice.call(e.querySelectorAll("select, input"));return n.forEach(function(e){t.push({name:e.name,value:e.value})}),t}function i(e,t){var n=function(e,t){return e&&"metric"===e.role&&t.unit&&t.unit.hasOwnProperty("label")?" ("+t.unit.label+")":""};return t.label.capitalize()+n(e,t)}function l(e,t,n){var r,o='<select name="'+t+'">',l=[];if(null!==n[1]){if(r=e.id,l=e.Dimension(),2===r.length)return l[0].label}else{var a=e.Dimension(t);if(r=a.id,l=a.Category(),1===r.length)return}return r.forEach(function(e,t){var r=e!==n[0]?"":'selected="selected" ';(null===n[1]||e!==n[1])&&(o+="<option "+r+'value="'+e+'">'+i(a,l[t])+"</option>")}),o+="</select>"}function a(e,t,r){var s="",u="",f="",p="",m=r.rows,g=t.Dimension(m),v=g.id,h=r.cols,y=t.Dimension(h),b=y.id,w=t.role&&t.role.metric?t.role.metric[0]:null,D=null!==w?t.Dimension(w):null,S=function(e){return e.hasOwnProperty("unit")&&e.unit&&e.unit.hasOwnProperty("decimals")?e.unit.decimals:null},E=r.filter,O=JSON.parse(JSON.stringify(E)),j=[],C="",L="",N=t.source?c.source+": "+t.source+".":"",R=null!==t.label?'<span class="label">'+t.label.capitalize()+"</span>":"";f+="<caption>"+R,f+=' <form><fieldset id="rowscols"><legend>'+c.rc+"</legend>"+l(t,"rows",[m,h])+" <a>&#x2194;</a> "+l(t,"cols",[h,m])+"</fieldset>";for(var q in E){var A=t.Dimension(q),J=A.label.capitalize();A.length>1?C+="<p>"+l(t,q,[E[q],null])+" <strong>"+J+"</strong></p>":j.push({label:J,value:i(A,A.Category(0)),name:q,id:A.id[0]})}""!==C&&(C='<fieldset id="filters"><legend>'+c.filters+"</legend>"+C+"</fieldset>"),j.forEach(function(e){L+="<p>"+e.value+" <strong>"+e.label+'</strong></p><input type="hidden" name="'+e.name+'" value="'+e.id+'" />'}),""!==L&&(L='<fieldset id="constants"><legend>'+c.constants+"</legend>"+L+"</fieldset>"),f+=C+L+"</form></caption>",p+="<tbody>";var z=Number.toLocaleString?function(e,t){return null===t?e.toLocaleString(d):e.toLocaleString(d,{minimumFractionDigits:t,maximumFractionDigits:t})}:function(e,t){return null===t?e:e.toFixed(t)};return v.forEach(function(e){O[m]=e;var n=t.Data(O),r=function(e,t){var n=h!==w?null===D?null:S(D.Category(O[w])):S(y.Category(t)),r=null!==e.value?z(e.value,n):e.status||c.na;p+="<td>"+r+"</td>"};return null===n?void(p="ERROR"):(p+='<tr><th scope="row">'+i(g,g.Category(e))+"</th>","[object Array]"===Object.prototype.toString.call(n)?n.forEach(function(e,t){r(e,t)}):r(n,0),void(p+="</tr>"))}),"ERROR"===p?c.dataerror:(p+="</tbody>",s+="<thead><tr><th></th>",b.forEach(function(e){s+='<th scope="col">'+i(y,y.Category(e))+"</th>"}),s+="</tr></thead>",""!==N&&(u='<tfoot><tr><td colspan="'+(b.length+1)+'">'+N+"</td></tr></tfoot>"),e.innerHTML="<table>"+f+s+u+p+"</table>",[].slice.call(e.querySelectorAll("select")).forEach(function(r){r.addEventListener("change",function(r){a(e,t,n(t,r.target.parentElement.getAttribute("id"),o(e)))},!1)}),void e.querySelector("a").addEventListener("click",function(){r.cols=m,r.rows=h,a(e,t,r)},!1))}var s,u=function(e){for(var t=e.length,n=1;t--;)n*=e.Dimension(t).length;return n!==e.n?!1:!0},c="undefined"==typeof e.i18n||"undefined"==typeof e.i18n.msgs?{selerror:'tbrowser: "selector" property is required!',urierror:'tbrowser: "jsonstat" property is required!',jsonerror:"Document is not valid JSON-stat.",dserror:"Dataset ID is not correct.",dimerror:"Only one dimension was found in the dataset. At least two are required.",dataerror:"Selection returned no data!",source:"Source",filters:"Filters",constants:"Constants",rc:"Rows &amp; Columns",na:"n/a"}:e.i18n.msgs,d="undefined"==typeof e.i18n||"undefined"==typeof e.i18n.locale?"en-US":e.i18n.locale,f=e.dsid||0;if("undefined"==typeof e.selector)return void t("selerror");if("undefined"==typeof e.jsonstat)return void t("urierror");if(s="string"==typeof e.jsonstat?JSONstat(e.jsonstat):"undefined"==typeof e.jsonstat.length?JSONstat(e.jsonstat):e.jsonstat,0===s.length)return void t("jsonerror");var p="dataset"===s.class?s:s.Dataset(f);return u(p)?null===p?void t("dserror"):1===p.length?void t("dimerror"):void a(e.selector,p,r(p)):void t("jsonerror")}return String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},{tbrowser:e}}();